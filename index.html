<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

<script defer src="./frank.js"></script>


<script type="text/javascript">
  var count = 0;
  document.getElementById("tint").width = window.innerWidth;
  document.getElementById("tint").height = window.innerHeight;
  document.getElementById("tint").backgroundColor = "#";
  document.getElementById("tint").style.zIndex = "5";
  document.getElementById("tint").style.position = "absolute";
  function handle() {
    const sky = document.querySelector("a-sky");
    var b = false;
    this.el.addEventListener("click", () => {
      document.getElementById("count").innerText = (
        parseInt(document.getElementById("count").innerText) + 1
      ).toString();
      const marker = document.getElementById("marker");
      const parent = marker.parentNode;
      marker.parentNode.removeChild(marker);
      const newc = document.createElement("a-sphere");
      randomX = Math.random() * 10 - 5;
      randomY = Math.random() * 10 - 5;
      newc.setAttribute("color", "#EF2D5E");
      newc.setAttribute("position", `${randomX} ${randomY} -3`);
      newc.setAttribute("radius", "4.0");
      newc.id = "marker";
      parent.appendChild(newc);

      if (b) {
        sky.setAttribute("src", "#entrance");
      } else {
        sky.setAttribute("src", "#study");
      }
      b = !b;
      console.log("clicked");
    });
  }

  function stuff() {
        document.getElementById("count").innerText = (
          parseInt(document.getElementById("count").innerText) + 1
        ).toString();
        const marker = document.getElementById(`marker`);
        console.log("markler", marker)
        marker.color = "#EF2D5E";
        const parent = marker.parentNode;
        marker.parentNode.removeChild(marker);
        const newc = document.createElement("a-sphere");
        newc.setAttribute("color", "#EF2D5E");
        randomX = Math.random() * 20 - 10;
        randomY = Math.random() * 20 - 10;
        newc.setAttribute("position", `${randomX} 4 ${randomY}`);
        newc.setAttribute("radius", "2.0");
        newc.id = `marker`;
        parent.appendChild(newc);
        newc.addEventListener("click", stuff)
        AFRAME.registerComponent(`marker${count}`, {
          schema: {
            default: "",
          },
          handle,
        });
        count++;
       
      };

      function timer(){
    var sec = 20;
    var timer = setInterval(function(){
        document.getElementById('timer').innerHTML='00:'+sec;
        sec--;
        console.log("timer");
      
        if (sec < 0) {
            clearInterval(timer);
        }
    }, 1000);
}

timer();


  AFRAME.registerComponent("marker", {
    schema: {
      default: "",
    },
    init() {
      const sky = document.querySelector("a-sky");
      var b = false;
      this.el.addEventListener("click", () => {
        document.getElementById("count").innerText = (
          parseInt(document.getElementById("count").innerText) + 1
        ).toString();
        const marker = document.getElementById("marker");
        const parent = marker.parentNode;
        marker.parentNode.removeChild(marker);
        const newc = document.createElement("a-sphere");
        randomX = Math.random() * 10 - 5;
        randomY = Math.random() * 10 - 5;
        newc.setAttribute("color", "#EF2D5E");
        newc.setAttribute("position", `${randomX} ${randomY} -3`);
        newc.setAttribute("radius", "4.0");
        newc.id = `marker`;
        parent.appendChild(newc);
        newc.addEventListener("click", stuff)
        AFRAME.registerComponent(`marker${count}`, {
          schema: {
            default: "",
          },
          handle,
        });
        count++;
        if (count >= 10) {
            document.getElementById("score") = parseInt(document.getElementById("score")) + 100;
        }

        if (b) {
          sky.setAttribute("src", "#entrance");
        } else {
          sky.setAttribute("src", "#study");
        }
        b = !b;
        console.log("clicked");
      });
    },
  });
</script>

<style>
  .uiwrapper {
    width: 100vw;
    height: 100vh;
    position: absolute;
    top: 0;
    left: 0;
    text-align: center;
    pointer-events: none;
  }

  .uiblock {
    font-family: sans-serif;
    font-size: 4vmin;
    width: 10em;
    height: 1em;
    display: inline-block;
    color: #fff;
    background: rgba(0, 0, 100, 0.5);
    padding: 1em 2em;
    margin-top: 20vh;
  }

  #tint {
    width: 100vw !important;
    height: 120vh !important;
    margin-top: -20vh !important;
    opacity: 1.0;
  }

  

  #timer {
    margin-top: 30vh !important;
  }
  #score {
    margin-top: 40vh !important;
  }

  .as-console-wrapper {
    /* ignore console warnings in snippet view */
    display: none !important;
  }
</style>


<body>
  <a-scene cursor="rayOrigin:mouse" vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false"

  renderer="antialias: true; alpha: true">
  <a-sound src="src: url(sound.mp3)" autoplay="true" loop="true" position="0 2 5" on="1"></a-sound>

    <a-entity
      cursor="fuse: true; fuseTimeout: 500"
      position="0 0 -1"
      geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
      material="color: black; shader: flat"
    >
    </a-entity>
    <a-camera id="camera" gps-new-camera="gpsMinDistance: 5"></a-camera>
    <!-- <a-sky
      src="#entrance"
      rotation="0 -90 0"
      position="0 0 0"
      id="src-img-tpl"
    ></a-sky> -->
    <a-sphere
      href="http://google.com"
      id="marker"
      position="-5 3 -3"
      radius="04.0"
      color="#EF2D5E"
      marker
    ></a-sphere>
    
    <a-assets>
      <!-- <audio id="river" src="assets/Bg-music.wav" autoplay="true" loop="true"></audio> -->
    </a-assets>
  </a-scene>
  <script
      type="text/javascript"
      src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js"
    ></script>
    <script
      type="text/javascript"
      src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"
    ></script>
  <h1 id="count" class="uiblock uiwrapper">0</h1>
  <h1 id="timer" class="uiblock uiwrapper">00:30</h1>
  <h1 id="score" class="uiblock uiwrapper">0</h1>
  <div id="tint" class="uiblock uiwrapper" ></div>
</body>
